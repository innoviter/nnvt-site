---
---
<div id="consent-banner" style="display: none;">
  <div>
    <strong>Datenschutzeinstellungen</strong>
  </div>
  <div>
    Wir verwenden Cookies und andere Technologien, damit unsere Website zuverlässig und sicher läuft.
  </div>
  <div>
    <input type="checkbox" checked disabled>
    Notwendige<br/>
    <input type="checkbox" id="consent-analytics" checked>
    Anonymisierte Webanalyse
  </div>
  <div>
    <button id="consent-save-btn">Speichern</button>
  </div>
</div>

<script is:inline>
  function getConsent() {
    return JSON.parse(localStorage.getItem('consentSettings') || '{}');
  }

  function saveConsent() {
    var settings = {
      analytics: document.getElementById('consent-analytics').checked,
    };
    localStorage.setItem('consentSettings', JSON.stringify(settings));
    document.getElementById('consent-banner').style.display = 'none';
    applyConsent(settings);
  }

  function resetConsent() {
    localStorage.removeItem('consentSettings');
    location.reload();
  }

  function applyConsent(settings) {
    if (settings.analytics) {
      loadMatomo();
    }
  }

  function loadMatomo() {
    var _paq = window._paq = window._paq || [];

    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setCookieDomain", "*.innoviter.com"]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="//analytics.innv.it/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  }

  document.addEventListener('DOMContentLoaded', function() {
    var consent = getConsent();
    if (Object.keys(consent).length === 0) {
      document.getElementById('consent-banner').style.display = 'block';
    } else {
      applyConsent(consent);
    }

    var saveBtn = document.getElementById('consent-save-btn');
    if (saveBtn) {
      saveBtn.addEventListener('click', saveConsent);
    }

    var resetLink = document.getElementById('reset-consent-link');
    if (resetLink) {
      resetLink.addEventListener('click', function(e) {
        e.preventDefault();
        resetConsent();
      });
    }
  });
</script>
